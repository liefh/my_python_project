# import  subprocess,paramiko,xlwt,xlrd
import paramiko, xlsxwriter

# ip_list = ['172.26.12.112','172.26.12.113']
ip_list = ['172.26.12.112',
    '172.26.12.113',
    '172.26.12.114',
    '172.26.12.116',
    '172.26.12.121',
    '172.26.12.122',
    '172.26.12.123',
    '172.26.12.124',
    '172.26.12.126',
    '172.26.12.131',
    '172.26.12.132',
    '172.26.12.133',
    '172.26.12.134',
    '172.26.12.136',
    '172.26.12.142',
    '172.26.12.144',
    '172.26.12.145',
    '172.26.12.146',
    '172.26.12.152',
    '172.26.12.153',
    '172.26.12.154',
    '172.26.12.155',
    '172.26.12.156',
    '172.26.12.161',
    '172.26.12.162',
    '172.26.12.163',
    '172.26.12.164',
    '172.26.12.165',
    '172.26.12.166',
    '172.26.12.172',
    '172.26.12.173',
    '172.26.12.174',
    '172.26.12.175',
    '172.26.12.176',
    '172.26.13.111',
    '172.26.13.112',
    '172.26.13.113',
    '172.26.13.114',
    '172.26.13.115',
    '172.26.13.116',
    '172.26.13.121',
    '172.26.13.122',
    '172.26.13.123',
    '172.26.13.124',
    '172.26.13.125',
    '172.26.13.126',
    '172.26.13.131',
    '172.26.13.132',
    '172.26.13.133',
    '172.26.13.134',
    '172.26.13.135',
    '172.26.13.136',
    '172.26.13.141',
    '172.26.13.142',
    '172.26.13.143',
    '172.26.13.144',
    '172.26.13.145',
    '172.26.13.146',
    '172.26.13.151',
    '172.26.13.152',
    '172.26.13.153',
    '172.26.13.155',
    '172.26.13.156',
    '172.26.14.111',
    '172.26.14.112',
    '172.26.14.114',
    '172.26.14.115',
    '172.26.14.116',
    '172.26.14.121',
    '172.26.14.122',
    '172.26.14.123',
    '172.26.14.124',
    '172.26.14.125',
    '172.26.14.126',
    '172.26.14.132',
    '172.26.14.133',
    '172.26.14.134',
    '172.26.14.135',
    '172.26.14.136',
    '172.26.14.141',
    '172.26.14.142',
    '172.26.14.143',
    '172.26.14.144',
    '172.26.14.145',
    '172.26.14.146',
    '172.26.14.151',
    '172.26.14.152',
    '172.26.14.153',
    '172.26.14.154',
    '172.26.14.155',
    '172.26.14.156',
    '172.26.15.111',
    '172.26.15.112',
    '172.26.15.113',
    '172.26.15.114',
    '172.26.15.115',
    '172.26.15.116',
    '172.26.15.121',
    '172.26.15.122',
    '172.26.15.123',
    '172.26.15.124',
    '172.26.15.125',
    '172.26.15.126',
    # '172.26.15.131',
    '172.26.15.132',
    '172.26.15.133',
    '172.26.15.134',
    '172.26.15.135',
    '172.26.15.136',
    '172.26.15.141',
    '172.26.15.143',
    '172.26.15.144',
    '172.26.15.145',
    '172.26.15.146',
    '172.26.15.151',
    '172.26.15.152',
    '172.26.15.153',
    '172.26.15.154',
    '172.26.15.155',
    '172.26.15.156',
    '172.26.18.112',
    '172.26.18.113',
    '172.26.18.114',
    '172.26.18.115',
    '172.26.18.116',
    '172.26.18.122',
    '172.26.18.123',
    '172.26.18.124',
    '172.26.18.125',
    '172.26.18.126',
    '172.26.18.131',
    '172.26.18.132',
    '172.26.18.133',
    '172.26.18.134',
    '172.26.18.135',
    '172.26.18.136',
    '172.26.18.141',
    '172.26.18.142',
    '172.26.18.143',
    '172.26.18.144',
    '172.26.18.145',
    '172.26.18.146',
    '172.26.18.153',
    '172.26.18.154',
    '172.26.18.155',
    '172.26.18.157',
    '172.26.18.161',
    '172.26.18.162',
    '172.26.18.167',
    '172.26.26.111',
    '172.26.26.112',
    '172.26.26.113',
    '172.26.26.114',
    '172.26.26.115',
    '172.26.26.121',
    '172.26.26.122',
    '172.26.26.123',
    '172.26.26.124',
    '172.26.26.125',
    '172.26.26.131',
    '172.26.26.132',
    '172.26.26.133',
    '172.26.26.134',
    '172.26.26.135',
    '172.26.26.136',
    '172.26.26.141',
    '172.26.26.142',
    '172.26.26.143',
    '172.26.26.144',
    '172.26.26.145',
    '172.26.26.146',
    '172.26.26.151',
    '172.26.26.152',
    '172.26.26.153',
    '172.26.26.154',
    '172.26.26.155',
    '172.26.26.156',
    '172.26.26.157',
    '172.26.26.161',
    '172.26.26.162',
    '172.26.26.163',
    '172.26.26.164',
    '172.26.26.166',
    '172.26.26.171',
    '172.26.26.172',
    '172.26.26.174',
    '172.26.26.175',
    '172.26.26.176',
    '172.26.26.181',
    '172.26.26.182',
    '172.26.26.183',
    '172.26.26.184',
    '172.26.26.185',
    '172.26.27.111',
    '172.26.27.112',
    '172.26.27.113',
    '172.26.27.114',
    '172.26.27.115',
    '172.26.27.116',
    '172.26.27.121',
    '172.26.27.122',
    '172.26.27.123',
    '172.26.27.124',
    '172.26.27.125',
    '172.26.27.126',
    '172.26.27.132',
    '172.26.27.133',
    '172.26.27.134',
    '172.26.27.135',
    '172.26.27.136',
    '172.26.27.141',
    '172.26.27.142',
    '172.26.27.143',
    '172.26.27.144',
    '172.26.27.145',
    '172.26.27.146',
    '172.26.27.147',
    '172.26.27.151',
    '172.26.27.152',
    '172.26.27.153',
    '172.26.27.154',
    '172.26.27.155',
    '172.26.27.156',
    '172.26.30.171',
    '172.26.30.172',
    '172.26.30.173',
    '172.26.30.174',
    '172.26.30.176',
    '172.26.7.111',
    '172.26.7.112',
    '172.26.7.113',
    '172.26.7.114',
    '172.26.7.115',
    '172.26.7.116',
    '172.26.8.111',
    '172.26.8.112',
    '172.26.8.113',
    '172.26.8.114',
    '172.26.8.115',
    '172.26.8.116',
    '172.26.8.117',
    '172.26.8.121',
    '172.26.8.122',
    '172.26.8.124',
    '172.26.8.131',
    '172.26.8.132',
    '172.26.8.133',
    '172.26.8.134',
    '172.26.8.142',
    '172.26.8.144',
    '172.26.8.153',
    '172.26.8.154',
    '172.26.8.155',
    '172.26.8.156',
    '172.26.8.157',
    '172.26.8.161',
    '172.26.8.164',
    '172.26.8.165',
    '172.26.8.166',
    '172.26.8.167',
    '172.26.9.111',
    '172.26.9.112',
    '172.26.9.113',
    '172.26.9.114',
    '172.26.9.115',
    '172.26.9.116',
    '172.26.9.131',
    '172.26.9.132',
    '172.26.9.133',
    '172.26.9.134',
    '172.26.9.135',
    '172.26.9.136',
    '172.26.9.141',
    '172.26.9.142',
    '172.26.9.143',
    '172.26.9.144',
    '172.26.9.145',
    '172.26.9.151',
    '172.26.9.152',
    '172.26.9.153',
    '172.26.9.154',
    '172.26.9.155',
    '172.26.9.161',
    '172.26.9.162',
    '172.26.9.163',
    '172.26.9.164'
           ]
port = 62534

shell_cpu = "lscpu | grep 'Model name:' | awk  -F ':' '{print $NF}'"
shell_mem = "free -lh |grep 'Mem:' | awk '{print $2}'"
shell_gpu = "nvidia-smi -L"

pkey = '/root/.ssh/id_rsa'
key = paramiko.RSAKey.from_private_key_file(pkey)

workbook = xlsxwriter.Workbook('xj服务器.xlsx')
worksheet = workbook.add_worksheet('xj')
worksheet.write(0, 0, "IP")
worksheet.write(0, 1, "CPU")
worksheet.write(0, 2, "MeM")
worksheet.write(0, 3, "GPU")

row_num = 1
for ip in ip_list:
    print(ip)
    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy)
    ssh.connect(hostname=ip, port=port, username='root', pkey=key, timeout=3, auth_timeout=3)
    stdin, stdout, stderr = ssh.exec_command(shell_cpu)
    result_cpu = stdout.readlines()[0].strip()

    stdin, stdout, stderr = ssh.exec_command(shell_mem)
    result_mem = stdout.readlines()[0].strip()

    stdin, stdout, stderr = ssh.exec_command(shell_gpu)
    result_gpu=''
    for gpu_content in stdout.readlines():
        result_gpu = result_gpu + gpu_content.strip().strip('\n') + ';'

    worksheet.write(row_num, 0, ip)
    worksheet.write(row_num, 1, result_cpu)
    worksheet.write(row_num, 2, result_mem)
    worksheet.write(row_num, 3, result_gpu)

    print(row_num, ip, result_cpu, result_mem, result_gpu)
    ssh.close()
    row_num += 1

workbook.close()
print('finished')
